!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function t(e,t){this.cm=e,this.options=this.buildOptions(t),this.widget=null,this.tick=this.debounce=0,this.startPos=this.cm.getCursor(),this.startLen=this.cm.getLine(this.startPos.line).length;var a=this;e.on("cursorActivity",this.activityFunc=function(){a.cursorActivity()})}function a(e,t){function a(e,a){var n;n="string"!=typeof a?function(e){return a(e,t)}:i.hasOwnProperty(a)?i[a]:a,l[e]=n}var i={Up:function(){t.moveFocus(-1)},Down:function(){t.moveFocus(1)},PageUp:function(){t.moveFocus(-t.menuSize()+1,!0)},PageDown:function(){t.moveFocus(t.menuSize()-1,!0)},Home:function(){t.setFocus(0)},End:function(){t.setFocus(t.length-1)},Enter:t.pick,Tab:t.pick,Esc:t.close},n=e.options.customKeys,l=n?{}:i;if(n)for(var o in n)n.hasOwnProperty(o)&&a(o,n[o]);if(n=e.options.extraKeys)for(o in n)n.hasOwnProperty(o)&&a(o,n[o]);return l}function i(e,t){for(;t&&t!=e;){if("LI"===t.nodeName.toUpperCase()&&t.parentNode==e)return t;t=t.parentNode}}function n(t,n){this.completion=t,this.data=n,this.picked=!1;var l=this,o=t.cm,r=this.hints=document.createElement("ul");r.className="CodeMirror-hints",this.selectedHint=n.selectedHint||0;for(var s=n.list,d=0;d<s.length;++d){var c=r.appendChild(document.createElement("li")),u=s[d],p="CodeMirror-hint"+(d!=this.selectedHint?"":" CodeMirror-hint-active");null!=u.className&&(p=u.className+" "+p),c.className=p,u.render?u.render(c,n,u):c.appendChild(document.createTextNode(u.displayText||("string"==typeof u?u:u.text))),c.hintId=d}var d=o.cursorCoords(t.options.alignWithWord?n.from:null),m=d.left,g=d.bottom,h=!0;if(r.style.left=m+"px",r.style.top=g+"px",c=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth),p=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight),(t.options.container||document.body).appendChild(r),u=r.getBoundingClientRect(),0<u.bottom-p){var b=u.bottom-u.top;0<d.top-(d.bottom-u.top)-b?(r.style.top=(g=d.top-b)+"px",h=!1):b>p&&(r.style.height=p-5+"px",r.style.top=(g=d.bottom-u.top)+"px",p=o.getCursor(),n.from.ch!=p.ch&&(d=o.cursorCoords(p),r.style.left=(m=d.left)+"px",u=r.getBoundingClientRect()))}if(p=u.right-c,0<p&&(u.right-u.left>c&&(r.style.width=c-5+"px",p-=u.right-u.left-c),r.style.left=(m=d.left-p)+"px"),o.addKeyMap(this.keyMap=a(t,{moveFocus:function(e,t){l.changeActive(l.selectedHint+e,t)},setFocus:function(e){l.changeActive(e)},menuSize:function(){return l.screenAmount()},length:s.length,close:function(){t.close()},pick:function(){l.pick()},data:n})),t.options.closeOnUnfocus){var f;o.on("blur",this.onBlur=function(){f=setTimeout(function(){t.close()},100)}),o.on("focus",this.onFocus=function(){clearTimeout(f)})}var v=o.getScrollInfo();return o.on("scroll",this.onScroll=function(){var e=o.getScrollInfo(),a=o.getWrapperElement().getBoundingClientRect(),i=g+v.top-e.top,n=i-(window.pageYOffset||(document.documentElement||document.body).scrollTop);return h||(n+=r.offsetHeight),n<=a.top||n>=a.bottom?t.close():(r.style.top=i+"px",void(r.style.left=m+v.left-e.left+"px"))}),e.on(r,"dblclick",function(e){(e=i(r,e.target||e.srcElement))&&null!=e.hintId&&(l.changeActive(e.hintId),l.pick())}),e.on(r,"click",function(e){(e=i(r,e.target||e.srcElement))&&null!=e.hintId&&(l.changeActive(e.hintId),t.options.completeOnSingleClick&&l.pick())}),e.on(r,"mousedown",function(){setTimeout(function(){o.focus()},20)}),e.signal(n,"select",s[0],r.firstChild),!0}e.showHint=function(e,t,a){if(!t)return e.showHint(a);if(a&&a.async&&(t.async=!0),t={hint:t},a)for(var i in a)t[i]=a[i];return e.showHint(t)},e.defineExtension("showHint",function(a){1<this.listSelections().length||this.somethingSelected()||(this.state.completionActive&&this.state.completionActive.close(),a=this.state.completionActive=new t(this,a),a.options.hint&&(e.signal(this,"startCompletion",this),a.update()))});var l=window.requestAnimationFrame||function(e){return setTimeout(e,1e3/60)},o=window.cancelAnimationFrame||clearTimeout;t.prototype={close:function(){this.active()&&(this.tick=this.cm.state.completionActive=null,this.cm.off("cursorActivity",this.activityFunc),this.widget&&this.widget.close(),e.signal(this.cm,"endCompletion",this.cm))},active:function(){return this.cm.state.completionActive==this},pick:function(t,a){var i=t.list[a];i.hint?i.hint(this.cm,t,i):this.cm.replaceRange("string"==typeof i?i:i.text,i.from||t.from,i.to||t.to,"complete"),e.signal(t,"pick",i),this.close()},showHints:function(e){return e&&e.list.length&&this.active()?void(this.options.completeSingle&&1==e.list.length?this.pick(e,0):this.showWidget(e)):this.close()},cursorActivity:function(){this.debounce&&(o(this.debounce),this.debounce=0);var e=this.cm.getCursor(),t=this.cm.getLine(e.line);if(e.line!=this.startPos.line||t.length-e.ch!=this.startLen-this.startPos.ch||e.ch<this.startPos.ch||this.cm.somethingSelected()||e.ch&&this.options.closeCharacters.test(t.charAt(e.ch-1)))this.close();else{var a=this;this.debounce=l(function(){a.update()}),this.widget&&this.widget.disable()}},update:function(){if(null!=this.tick)if(this.data&&e.signal(this.data,"update"),this.options.hint.async){var t=++this.tick,a=this;this.options.hint(this.cm,function(e){a.tick==t&&a.finishUpdate(e)},this.options)}else this.finishUpdate(this.options.hint(this.cm,this.options),t)},finishUpdate:function(e){this.data=e;var t=this.widget&&this.widget.picked;this.widget&&this.widget.close(),e&&e.list.length&&(t&&1==e.list.length?this.pick(e,0):this.widget=new n(this,e))},showWidget:function(t){this.data=t,this.widget=new n(this,t),e.signal(t,"shown")},buildOptions:function(e){var t,a=this.cm.options.hintOptions,i={};for(t in r)i[t]=r[t];if(a)for(t in a)void 0!==a[t]&&(i[t]=a[t]);if(e)for(t in e)void 0!==e[t]&&(i[t]=e[t]);return i}},n.prototype={close:function(){if(this.completion.widget==this){this.completion.widget=null,this.hints.parentNode.removeChild(this.hints),this.completion.cm.removeKeyMap(this.keyMap);var e=this.completion.cm;this.completion.options.closeOnUnfocus&&(e.off("blur",this.onBlur),e.off("focus",this.onFocus)),e.off("scroll",this.onScroll)}},disable:function(){this.completion.cm.removeKeyMap(this.keyMap);var e=this;this.keyMap={Enter:function(){e.picked=!0}},this.completion.cm.addKeyMap(this.keyMap)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(t,a){if(t>=this.data.list.length?t=a?this.data.list.length-1:0:0>t&&(t=a?0:this.data.list.length-1),this.selectedHint!=t){var i=this.hints.childNodes[this.selectedHint];i.className=i.className.replace(" CodeMirror-hint-active",""),i=this.hints.childNodes[this.selectedHint=t],i.className+=" CodeMirror-hint-active",i.offsetTop<this.hints.scrollTop?this.hints.scrollTop=i.offsetTop-3:i.offsetTop+i.offsetHeight>this.hints.scrollTop+this.hints.clientHeight&&(this.hints.scrollTop=i.offsetTop+i.offsetHeight-this.hints.clientHeight+3),e.signal(this.data,"select",this.data.list[this.selectedHint],i)}},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}},e.registerHelper("hint","auto",function(t,a){var i=t.getHelpers(t.getCursor(),"hint");if(i.length)for(var n=0;n<i.length;n++){var l=i[n](t,a);if(l&&l.list.length)return l}else if(i=t.getHelper(t.getCursor(),"hintWords")){if(i)return e.hint.fromList(t,{words:i})}else if(e.hint.anyword)return e.hint.anyword(t,a)}),e.registerHelper("hint","fromList",function(t,a){for(var i=t.getCursor(),n=t.getTokenAt(i),l=[],o=0;o<a.words.length;o++){var r=a.words[o];r.slice(0,n.string.length)==n.string&&l.push(r)}if(l.length)return{list:l,from:e.Pos(i.line,n.start),to:e.Pos(i.line,n.end)}}),e.commands.autocomplete=e.showHint;var r={hint:e.hint.auto,completeSingle:!0,alignWithWord:!0,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:!0,completeOnSingleClick:!1,container:null,customKeys:null,extraKeys:null};e.defineOption("hintOptions",null)});