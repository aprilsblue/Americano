!function(){function e(e){return e.type==CKEDITOR.NODE_TEXT&&0<e.getLength()&&(!i||!e.isReadOnly())}function a(e){return!(e.type==CKEDITOR.NODE_ELEMENT&&e.isBlockBoundary(CKEDITOR.tools.extend({},CKEDITOR.dtd.$empty,CKEDITOR.dtd.$nonEditable)))}function t(t,r){function s(t,i){var o=this,n=new CKEDITOR.dom.walker(t);n.guard=i?a:function(e){!a(e)&&(o._.matchBoundary=!0)},n.evaluator=e,n.breakOnFalse=1,t.startContainer.type==CKEDITOR.NODE_TEXT&&(this.textNode=t.startContainer,this.offset=t.startOffset-1),this._={matchWord:i,walker:n,matchBoundary:!1}}function d(e,a){var i=t.createRange();return i.setStart(e.textNode,a?e.offset:e.offset+1),i.setEndAt(t.editable(),CKEDITOR.POSITION_BEFORE_END),i}function u(e){var a=t.getSelection().getRanges()[0],i=t.editable();return a&&!e?(e=a.clone(),e.collapse(!0)):(e=t.createRange(),e.setStartAt(i,CKEDITOR.POSITION_AFTER_START)),e.setEndAt(i,CKEDITOR.POSITION_BEFORE_END),e}var c=new CKEDITOR.style(CKEDITOR.tools.extend({attributes:{"data-cke-highlight":1},fullMatch:1,ignoreReadonly:1,childRule:function(){return 0}},t.config.find_highlight,!0));s.prototype={next:function(){return this.move()},back:function(){return this.move(!0)},move:function(e){var a=this.textNode;if(null===a)return o.call(this);if(this._.matchBoundary=!1,a&&e&&0<this.offset)this.offset--;else if(a&&this.offset<a.getLength()-1)this.offset++;else{for(a=null;!(a||(a=this._.walker[e?"previous":"next"].call(this._.walker),this._.matchWord&&!a||this._.walker._.end)););this.offset=(this.textNode=a)&&e?a.getLength()-1:0}return o.call(this)}};var p=function(e,a){this._={walker:e,cursors:[],rangeLength:a,highlightRange:null,isMatched:0}};p.prototype={toDomRange:function(){var e=t.createRange(),a=this._.cursors;if(1>a.length){var i=this._.walker.textNode;if(!i)return null;e.setStartAfter(i)}else i=a[0],a=a[a.length-1],e.setStart(i.textNode,i.offset),e.setEnd(a.textNode,a.offset+1);return e},updateFromDomRange:function(e){var a=new s(e);this._.cursors=[];do e=a.next(),e.character&&this._.cursors.push(e);while(e.character);this._.rangeLength=this._.cursors.length},setMatched:function(){this._.isMatched=!0},clearMatched:function(){this._.isMatched=!1},isMatched:function(){return this._.isMatched},highlight:function(){if(!(1>this._.cursors.length)){this._.highlightRange&&this.removeHighlight();var e=this.toDomRange(),a=e.createBookmark();c.applyToRange(e,t),e.moveToBookmark(a),this._.highlightRange=e,a=e.startContainer,a.type!=CKEDITOR.NODE_ELEMENT&&(a=a.getParent()),a.scrollIntoView(),this.updateFromDomRange(e)}},removeHighlight:function(){if(this._.highlightRange){var e=this._.highlightRange.createBookmark();c.removeFromRange(this._.highlightRange,t),this._.highlightRange.moveToBookmark(e),this.updateFromDomRange(this._.highlightRange),this._.highlightRange=null}},isReadOnly:function(){return this._.highlightRange?this._.highlightRange.startContainer.isReadOnly():0},moveBack:function(){var e=this._.walker.back(),a=this._.cursors;return e.hitMatchBoundary&&(this._.cursors=a=[]),a.unshift(e),a.length>this._.rangeLength&&a.pop(),e},moveNext:function(){var e=this._.walker.next(),a=this._.cursors;return e.hitMatchBoundary&&(this._.cursors=a=[]),a.push(e),a.length>this._.rangeLength&&a.shift(),e},getEndCharacter:function(){var e=this._.cursors;return 1>e.length?null:e[e.length-1].character},getNextCharacterRange:function(e){var a,t;return t=this._.cursors,t=(a=t[t.length-1])&&a.textNode?new s(d(a)):this._.walker,new p(t,e)},getCursors:function(){return this._.cursors}};var m=function(e,a){var t=[-1];a&&(e=e.toLowerCase());for(var i=0;i<e.length;i++)for(t.push(t[i]+1);0<t[i+1]&&e.charAt(i)!=e.charAt(t[i+1]-1);)t[i+1]=t[t[i+1]-1]+1;this._={overlap:t,state:0,ignoreCase:!!a,pattern:e}};m.prototype={feedCharacter:function(e){for(this._.ignoreCase&&(e=e.toLowerCase());;){if(e==this._.pattern.charAt(this._.state))return this._.state++,this._.state==this._.pattern.length?(this._.state=0,2):1;if(!this._.state)return 0;this._.state=this._.overlap[this._.state]}},reset:function(){this._.state=0}};var g=/[.,"'?!;: \u0085\u00a0\u1680\u280e\u2028\u2029\u202f\u205f\u3000]/,b=function(e){if(!e)return!0;var a=e.charCodeAt(0);return 9<=a&&13>=a||8192<=a&&8202>=a||g.test(e)},h={searchRange:null,matchRange:null,find:function(e,a,i,o,n,l){this.matchRange?(this.matchRange.removeHighlight(),this.matchRange=this.matchRange.getNextCharacterRange(e.length)):this.matchRange=new p(new s(this.searchRange),e.length);for(var r=new m(e,!a),c=0,g="%";null!==g;){for(this.matchRange.moveNext();(g=this.matchRange.getEndCharacter())&&(c=r.feedCharacter(g),2!=c);)this.matchRange.moveNext().hitMatchBoundary&&r.reset();if(2==c){if(i){var h=this.matchRange.getCursors(),k=h[h.length-1],h=h[0],v=t.createRange();if(v.setStartAt(t.editable(),CKEDITOR.POSITION_AFTER_START),v.setEnd(h.textNode,h.offset),h=v,k=d(k),h.trim(),k.trim(),h=new s(h,!0),k=new s(k,!0),!b(h.back().character)||!b(k.next().character))continue}return this.matchRange.setMatched(),!1!==n&&this.matchRange.highlight(),!0}}return this.matchRange.clearMatched(),this.matchRange.removeHighlight(),!(!o||l)&&(this.searchRange=u(1),this.matchRange=null,arguments.callee.apply(this,Array.prototype.slice.call(arguments).concat([!0])))},replaceCounter:0,replace:function(e,a,o,n,l,r,s){if(i=1,e=0,e=this.hasMatchOptionsChanged(a,n,l),!this.matchRange||!this.matchRange.isMatched()||this.matchRange._.isReplaced||this.matchRange.isReadOnly()||e)e&&this.matchRange&&(this.matchRange.clearMatched(),this.matchRange.removeHighlight(),this.matchRange=null),e=this.find(a,n,l,r,!s);else{if(this.matchRange.removeHighlight(),a=this.matchRange.toDomRange(),o=t.document.createText(o),!s){var d=t.getSelection();d.selectRanges([a]),t.fire("saveSnapshot")}a.deleteContents(),a.insertNode(o),s||(d.selectRanges([a]),t.fire("saveSnapshot")),this.matchRange.updateFromDomRange(a),s||this.matchRange.highlight(),this.matchRange._.isReplaced=!0,this.replaceCounter++,e=1}return i=0,e},matchOptions:null,hasMatchOptionsChanged:function(e,a,t){return e=[e,a,t].join("."),a=this.matchOptions&&this.matchOptions!=e,this.matchOptions=e,a}},k=t.lang.find;return{title:k.title,resizable:CKEDITOR.DIALOG_RESIZE_NONE,minWidth:350,minHeight:170,buttons:[CKEDITOR.dialog.cancelButton(t,{label:t.lang.common.close})],contents:[{id:"find",label:k.find,title:k.find,accessKey:"",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindFind",label:k.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",id:"btnFind",align:"left",style:"width:100%",label:k.find,onClick:function(){var e=this.getDialog();h.find(e.getValueOf("find","txtFindFind"),e.getValueOf("find","txtFindCaseChk"),e.getValueOf("find","txtFindWordChk"),e.getValueOf("find","txtFindCyclic"))||alert(k.notFoundMsg)}}]},{type:"fieldset",className:"cke_dialog_find_fieldset",label:CKEDITOR.tools.htmlEncode(k.findOptions),style:"margin-top:29px",children:[{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtFindCaseChk",isChanged:!1,label:k.matchCase},{type:"checkbox",id:"txtFindWordChk",isChanged:!1,label:k.matchWord},{type:"checkbox",id:"txtFindCyclic",isChanged:!1,"default":!0,label:k.matchCyclic}]}]}]},{id:"replace",label:k.replace,accessKey:"M",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindReplace",label:k.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",id:"btnFindReplace",align:"left",style:"width:100%",label:k.replace,onClick:function(){var e=this.getDialog();h.replace(e,e.getValueOf("replace","txtFindReplace"),e.getValueOf("replace","txtReplace"),e.getValueOf("replace","txtReplaceCaseChk"),e.getValueOf("replace","txtReplaceWordChk"),e.getValueOf("replace","txtReplaceCyclic"))||alert(k.notFoundMsg)}}]},{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtReplace",label:k.replaceWith,isChanged:!1,labelLayout:"horizontal",accessKey:"R"},{type:"button",id:"btnReplaceAll",align:"left",style:"width:100%",label:k.replaceAll,isChanged:!1,onClick:function(){var e=this.getDialog();for(h.replaceCounter=0,h.searchRange=u(1),h.matchRange&&(h.matchRange.removeHighlight(),h.matchRange=null),t.fire("saveSnapshot");h.replace(e,e.getValueOf("replace","txtFindReplace"),e.getValueOf("replace","txtReplace"),e.getValueOf("replace","txtReplaceCaseChk"),e.getValueOf("replace","txtReplaceWordChk"),!1,!0););h.replaceCounter?(alert(k.replaceSuccessMsg.replace(/%1/,h.replaceCounter)),t.fire("saveSnapshot")):alert(k.notFoundMsg)}}]},{type:"fieldset",label:CKEDITOR.tools.htmlEncode(k.findOptions),children:[{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtReplaceCaseChk",isChanged:!1,label:k.matchCase},{type:"checkbox",id:"txtReplaceWordChk",isChanged:!1,label:k.matchWord},{type:"checkbox",id:"txtReplaceCyclic",isChanged:!1,"default":!0,label:k.matchCyclic}]}]}]}],onLoad:function(){var e,a=this,t=0;this.on("hide",function(){t=0}),this.on("show",function(){t=1}),this.selectPage=CKEDITOR.tools.override(this.selectPage,function(i){return function(o){i.call(a,o);var r,s=a._.tabs[o];if(r="find"===o?"txtFindWordChk":"txtReplaceWordChk",e=a.getContentElement(o,"find"===o?"txtFindFind":"txtFindReplace"),a.getContentElement(o,r),s.initialized||(CKEDITOR.document.getById(e._.inputId),s.initialized=!0),t){var d;o="find"===o?1:0;var u,s=1-o,c=l.length;for(u=0;u<c;u++)r=this.getContentElement(n[o],l[u][o]),d=this.getContentElement(n[s],l[u][s]),d.setValue(r.getValue())}}})},onShow:function(){h.searchRange=u();var e=this.getParentEditor().getSelection().getSelectedText(),a=this.getContentElement(r,"find"==r?"txtFindFind":"txtFindReplace");a.setValue(e),a.select(),this.selectPage(r),this[("find"==r&&this._.editor.readOnly?"hide":"show")+"Page"]("replace")},onHide:function(){var e;h.matchRange&&h.matchRange.isMatched()&&(h.matchRange.removeHighlight(),(e=h.matchRange.toDomRange())&&t.getSelection().selectRanges([e]),t.focus()),delete h.matchRange},onFocus:function(){return"replace"==r?this.getContentElement("replace","txtFindReplace"):this.getContentElement("find","txtFindFind")}}}var i,o=function(){return{textNode:this.textNode,offset:this.offset,character:this.textNode?this.textNode.getText().charAt(this.offset):null,hitMatchBoundary:this._.matchBoundary}},n=["find","replace"],l=[["txtFindFind","txtFindReplace"],["txtFindCaseChk","txtReplaceCaseChk"],["txtFindWordChk","txtReplaceWordChk"],["txtFindCyclic","txtReplaceCyclic"]];CKEDITOR.dialog.add("find",function(e){return t(e,"find")}),CKEDITOR.dialog.add("replace",function(e){return t(e,"replace")})}();