CKEDITOR.dialog.add("specialchar",function(e){var a,t,i=e.lang.specialchar,l=function(t){var i;t=t.data?t.data.getTarget():new CKEDITOR.dom.element(t),"a"==t.getName()&&(i=t.getChild(0).getHtml())&&(t.removeClass("cke_light_background"),a.hide(),t=e.document.createElement("span"),t.setHtml(i),e.insertText(t.getText()))},n=CKEDITOR.tools.addFunction(l),o=function(e,i){var l;if(i=i||e.data.getTarget(),"span"==i.getName()&&(i=i.getParent()),"a"==i.getName()&&(l=i.getChild(0).getHtml())){t&&r(null,t);var n=a.getContentElement("info","htmlPreview").getElement();a.getContentElement("info","charPreview").getElement().setHtml(l),n.setHtml(CKEDITOR.tools.htmlEncode(l)),i.getParent().addClass("cke_light_background"),t=i}},r=function(e,i){i=i||e.data.getTarget(),"span"==i.getName()&&(i=i.getParent()),"a"==i.getName()&&(a.getContentElement("info","charPreview").getElement().setHtml("&nbsp;"),a.getContentElement("info","htmlPreview").getElement().setHtml("&nbsp;"),i.getParent().removeClass("cke_light_background"),t=void 0)},s=CKEDITOR.tools.addFunction(function(a){a=new CKEDITOR.dom.event(a);var t,i=a.getTarget();t=a.getKeystroke();var n="rtl"==e.lang.dir;switch(t){case 38:(t=i.getParent().getParent().getPrevious())&&(t=t.getChild([i.getParent().getIndex(),0]),t.focus(),r(null,i),o(null,t)),a.preventDefault();break;case 40:(t=i.getParent().getParent().getNext())&&(t=t.getChild([i.getParent().getIndex(),0]))&&1==t.type&&(t.focus(),r(null,i),o(null,t)),a.preventDefault();break;case 32:l({data:a}),a.preventDefault();break;case n?37:39:(t=i.getParent().getNext())?(t=t.getChild(0),1==t.type?(t.focus(),r(null,i),o(null,t),a.preventDefault(!0)):r(null,i)):(t=i.getParent().getParent().getNext())&&((t=t.getChild([0,0]))&&1==t.type?(t.focus(),r(null,i),o(null,t),a.preventDefault(!0)):r(null,i));break;case n?39:37:(t=i.getParent().getPrevious())?(t=t.getChild(0),t.focus(),r(null,i),o(null,t),a.preventDefault(!0)):(t=i.getParent().getParent().getPrevious())?(t=t.getLast().getChild(0),t.focus(),r(null,i),o(null,t),a.preventDefault(!0)):r(null,i)}});return{title:i.title,minWidth:430,minHeight:280,buttons:[CKEDITOR.dialog.cancelButton],charColumns:17,onLoad:function(){for(var a,t,l=this.definition.charColumns,o=e.config.specialChars,r=CKEDITOR.tools.getNextId()+"_specialchar_table_label",d=['<table role="listbox" aria-labelledby="'+r+'" style="width: 320px; height: 100%; border-collapse: separate;" align="center" cellspacing="2" cellpadding="2" border="0">'],c=0,u=o.length;c<u;){d.push('<tr role="presentation">');for(var m=0;m<l;m++,c++){if(a=o[c]){a instanceof Array?(t=a[1],a=a[0]):(t=a.replace("&","").replace(";","").replace("#",""),t=i[t]||a);var p="cke_specialchar_label_"+c+"_"+CKEDITOR.tools.getNextNumber();d.push('<td class="cke_dark_background" style="cursor: default" role="presentation"><a href="javascript: void(0);" role="option" aria-posinset="'+(c+1)+'"',' aria-setsize="'+u+'"',' aria-labelledby="'+p+'"',' class="cke_specialchar" title="',CKEDITOR.tools.htmlEncode(t),'" onkeydown="CKEDITOR.tools.callFunction( '+s+', event, this )" onclick="CKEDITOR.tools.callFunction('+n+', this); return false;" tabindex="-1"><span style="margin: 0 auto;cursor: inherit">'+a+'</span><span class="cke_voice_label" id="'+p+'">'+t+"</span></a>")}else d.push('<td class="cke_dark_background">&nbsp;');d.push("</td>")}d.push("</tr>")}d.push("</tbody></table>",'<span id="'+r+'" class="cke_voice_label">'+i.options+"</span>"),this.getContentElement("info","charContainer").getElement().setHtml(d.join(""))},contents:[{id:"info",label:e.lang.common.generalTab,title:e.lang.common.generalTab,padding:0,align:"top",elements:[{type:"hbox",align:"top",widths:["320px","90px"],children:[{type:"html",id:"charContainer",html:"",onMouseover:o,onMouseout:r,focus:function(){var e=this.getElement().getElementsByTag("a").getItem(0);setTimeout(function(){e.focus(),o(null,e)},0)},onShow:function(){var e=this.getElement().getChild([0,0,0,0,0]);setTimeout(function(){e.focus(),o(null,e)},0)},onLoad:function(e){a=e.sender}},{type:"hbox",align:"top",widths:["100%"],children:[{type:"vbox",align:"top",children:[{type:"html",html:"<div></div>"},{type:"html",id:"charPreview",className:"cke_dark_background",style:"border:1px solid #eeeeee;font-size:28px;height:40px;width:70px;padding-top:9px;font-family:'Microsoft Sans Serif',Arial,Helvetica,Verdana;text-align:center;",html:"<div>&nbsp;</div>"},{type:"html",id:"htmlPreview",className:"cke_dark_background",style:"border:1px solid #eeeeee;font-size:14px;height:20px;width:70px;padding-top:2px;font-family:'Microsoft Sans Serif',Arial,Helvetica,Verdana;text-align:center;",html:"<div>&nbsp;</div>"}]}]}]}]}]}});