"use strict";!function(){function e(e){this.editor=e,this.registered={},this.instances={},this.selected=[],this.focused=null,this.widgetHoldingFocusedEditable=null,this._={nextId:0,upcasts:[],upcastCallbacks:[],filters:{}},L(this),w(this),T(this),A(this),S(this),C(this)}function a(e,t,i,l,n){var o=e.editor;CKEDITOR.tools.extend(this,l,{editor:o,id:t,inline:"span"==i.getParent().getName(),element:i,data:CKEDITOR.tools.extend({},"function"==typeof l.defaults?l.defaults():l.defaults),dataReady:!1,inited:!1,ready:!1,edit:a.prototype.edit,focusedEditable:null,definition:l,repository:e,draggable:l.draggable!==!1,_:{downcastFn:l.downcast&&"string"==typeof l.downcast?l.downcasts[l.downcast]:l.downcast}},!0),e.fire("instanceCreated",this),U(this,l),this.init&&this.init(),this.inited=!0,_(this,n),this.isInited()&&o.editable().contains(this.wrapper)&&(this.ready=!0,this.fire("ready"))}function t(e,a,t){CKEDITOR.dom.element.call(this,a.$),this.editor=e,this._={};var i=this.filter=t.filter;CKEDITOR.dtd[this.getName()].p?(this.enterMode=i?i.getAllowedEnterMode(e.enterMode):e.enterMode,this.shiftEnterMode=i?i.getAllowedEnterMode(e.shiftEnterMode,!0):e.shiftEnterMode):this.enterMode=this.shiftEnterMode=CKEDITOR.ENTER_BR}function i(e){var a,t,i,l=e.widgets.registered;for(t in l)a=l[t],i=a.button,i&&e.ui.addButton&&e.ui.addButton(CKEDITOR.tools.capitalize(a.name,!0),{label:i,command:a.name,toolbar:"insert,10"})}function l(e,a){e.addCommand(a.name,{exec:function(e,t){function i(){e.widgets.finalizeCreation(d)}var l=e.widgets.focused;if(l&&l.name==a.name)l.edit();else if(a.insert)a.insert();else if(a.template){var n,o="function"==typeof a.defaults?a.defaults():a.defaults,r=CKEDITOR.dom.element.createFromHtml(a.template.output(o)),s=e.widgets.wrapElement(r,a.name),d=new CKEDITOR.dom.documentFragment(s.getDocument());if(d.append(s),n=e.widgets.initOn(r,a,t&&t.startupData),!n)return void i();var c=n.once("edit",function(a){a.data.dialog?n.once("dialog",function(a){var t,l,o=a.data;t=o.once("ok",i,null,null,20),l=o.once("cancel",function(a){a.data&&a.data.hide===!1||e.widgets.destroy(n,!0)}),o.once("hide",function(){t.removeListener(),l.removeListener()})}):i()},null,null,999);n.edit(),c.removeListener()}},allowedContent:a.allowedContent,requiredContent:a.requiredContent,contentForms:a.contentForms,contentTransformations:a.contentTransformations})}function n(e,a){function t(a,t,i){var l=CKEDITOR.tools.getIndex(e._.upcasts,function(e){return e[2]>i});l<0&&(l=e._.upcasts.length),e._.upcasts.splice(l,0,[a,t,i])}var i,l=a.upcast,n=a.upcastPriority||10;if(l)if("string"==typeof l)for(i=l.split(",");i.length;)t(a.upcasts[i.pop()],a.name,n);else t(l,a.name,n)}function o(e,a){if(e.focused=null,a.isInited()){var t=a.editor.checkDirty();e.fire("widgetBlurred",{widget:a}),a.setFocused(!1),!t&&a.editor.resetDirty()}}function r(e){var t=e.data;if("wysiwyg"==this.editor.mode){var i,l,n,o,r,s=this.editor.editable(),d=this.instances;if(s){for(l in d)d[l].isReady()&&!s.contains(d[l].wrapper)&&this.destroy(d[l],!0);if(t&&t.initOnlyNew)i=this.initOnAll();else{var c=s.find(".cke_widget_wrapper");for(i=[],l=0,n=c.count();l<n;l++)o=c.getItem(l),r=!this.getByElement(o,!0),r&&!m(o,b)&&s.contains(o)&&(o.addClass("cke_widget_new"),i.push(this.initOn(o.getFirst(a.isDomWidgetElement))))}t&&t.focusInited&&1==i.length&&i[0].focus()}}}function s(e){var a=e.parent;a.type==CKEDITOR.NODE_ELEMENT&&a.attributes["data-cke-widget-wrapper"]&&a.replaceWith(e)}function d(e,t){for(var i,l,n=t.find(".cke_widget_wrapper"),o=0,r=n.count();o<r;++o)i=n.getItem(o),l=i.getFirst(a.isDomWidgetElement),l.type==CKEDITOR.NODE_ELEMENT&&l.data("widget")?(l.replace(i),e.wrapElement(l)):i.remove()}function c(e,a,t){if(!t.allowedContent)return null;var i=this._.filters[e];i||(this._.filters[e]=i={});var l=i[a];return l||(i[a]=l=new CKEDITOR.filter(t.allowedContent)),l}function u(e){var t=[],i=e._.upcasts,l=e._.upcastCallbacks;return{toBeWrapped:t,iterator:function(e){var n,o,r,s,d,c;if("data-cke-widget-wrapper"in e.attributes)return e=e.getFirst(a.isParserWidgetElement),e&&t.push([e]),!1;if("data-widget"in e.attributes)return t.push([e]),!1;if(d=i.length){if(e.attributes["data-cke-widget-upcasted"])return!1;for(s=0,c=l.length;s<c;++s)if(l[s](e)===!1)return;for(s=0;s<d;++s)if(n=i[s],r={},o=n[0](e,r))return o instanceof CKEDITOR.htmlParser.element&&(e=o),e.attributes["data-cke-widget-data"]=encodeURIComponent(JSON.stringify(r)),e.attributes["data-cke-widget-upcasted"]=1,t.push([e,n[1]]),!1}}}}function m(e,a){for(var t=e;t=t.getParent();)if(a(t))return!0;return!1}function p(e,a){return{tabindex:-1,contenteditable:"false","data-cke-widget-wrapper":1,"data-cke-filter":"off","class":"cke_widget_wrapper cke_widget_new cke_widget_"+(e?"inline":"block")+(a?" cke_widget_"+a:"")}}function g(e,a,t){if(e.type==CKEDITOR.NODE_ELEMENT){var i=CKEDITOR.dtd[e.name];if(i&&!i[t.name]){var l=e.split(a),n=e.parent;return a=l.getIndex(),e.children.length||(a-=1,e.remove()),l.children.length||l.remove(),g(n,a,t)}}e.add(t,a)}function h(e,a){return"boolean"==typeof e.inline?e.inline:!!CKEDITOR.dtd.$inline[a]}function b(e){return e.hasAttribute("data-cke-temp")}function k(e,a){var t,i=e.focusedEditable;if(a==CKEDITOR.CTRL+65){var l=i.getBogus();return t=e.editor.createRange(),t.selectNodeContents(i),l&&t.setEndAt(l,CKEDITOR.POSITION_BEFORE_START),t.select(),!1}if(8==a||46==a){var n=e.editor.getSelection().getRanges();return t=n[0],!(1==n.length&&t.collapsed&&t.checkBoundaryOfElement(i,CKEDITOR[8==a?"START":"END"]))}}function v(e,a,t,i){var l=e.editor;if(l.fire("lockSnapshot"),t){var n=t.data("cke-widget-editable"),o=a.editables[n];e.widgetHoldingFocusedEditable=a,a.focusedEditable=o,t.addClass("cke_widget_editable_focused"),o.filter&&l.setActiveFilter(o.filter),l.setActiveEnterMode(o.enterMode,o.shiftEnterMode)}else i||a.focusedEditable.removeClass("cke_widget_editable_focused"),a.focusedEditable=null,e.widgetHoldingFocusedEditable=null,l.setActiveFilter(null),l.setActiveEnterMode(null,null);l.fire("unlockSnapshot")}function y(e){e.contextMenu&&e.contextMenu.addListener(function(a){var t=e.widgets.getByElement(a,!0);if(t)return t.fire("contextMenu",{})})}function f(e,a){return CKEDITOR.tools.trim(a)}function S(e){var t=e.editor,i=CKEDITOR.plugins.lineutils;t.on("dragstart",function(i){var l=i.data.target;if(a.isDomDragHandler(l)){var n=e.getByElement(l);i.data.dataTransfer.setData("cke/widget-id",n.id),t.focus(),n.focus()}}),t.on("drop",function(a){var i,l=a.data.dataTransfer,n=l.getData("cke/widget-id"),o=l.getTransferType(t),r=t.createRange();return""!==n&&o===CKEDITOR.DATA_TRANSFER_CROSS_EDITORS?void a.cancel():void(""!==n&&o==CKEDITOR.DATA_TRANSFER_INTERNAL&&(i=e.instances[n],i&&(r.setStartBefore(i.wrapper),r.setEndAfter(i.wrapper),a.data.dragRange=r,delete CKEDITOR.plugins.clipboard.dragStartContainerChildCount,delete CKEDITOR.plugins.clipboard.dragEndContainerChildCount,a.data.dataTransfer.setData("text/html",t.editable().getHtmlFromRange(r).getHtml()),t.widgets.destroy(i,!0))))}),t.on("contentDom",function(){var l=t.editable();CKEDITOR.tools.extend(e,{finder:new i.finder(t,{lookups:{"default":function(t){if(!t.is(CKEDITOR.dtd.$listItem)&&t.is(CKEDITOR.dtd.$block)&&!a.isDomNestedEditable(t)&&!e._.draggedWidget.wrapper.contains(t)){var i=a.getNestedEditable(l,t);if(i){var n=e._.draggedWidget;if(e.getByElement(i)==n)return;var o=CKEDITOR.filter.instances[i.data("cke-filter")],r=n.requiredContent;if(o&&r&&!o.check(r))return}return CKEDITOR.LINEUTILS_BEFORE|CKEDITOR.LINEUTILS_AFTER}}}}),locator:new i.locator(t),liner:new i.liner(t,{lineStyle:{cursor:"move !important","border-top-color":"#666"},tipLeftStyle:{"border-left-color":"#666"},tipRightStyle:{"border-right-color":"#666"}})},!0)})}function T(e){var t=e.editor;t.on("contentDom",function(){var i,l,n=t.editable(),o=n.isInline()?n:t.document;n.attachListener(o,"mousedown",function(n){var o=n.data.getTarget();if(!o.type)return!1;if(i=e.getByElement(o),l=0,i){if(i.inline&&o.type==CKEDITOR.NODE_ELEMENT&&o.hasAttribute("data-cke-widget-drag-handler"))return l=1,void(e.focused!=i&&t.getSelection().removeAllRanges());a.getNestedEditable(i.wrapper,o)?i=null:(n.data.preventDefault(),CKEDITOR.env.ie||i.focus())}}),n.attachListener(o,"mouseup",function(){l&&i&&i.wrapper&&(l=0,i.focus())}),CKEDITOR.env.ie&&n.attachListener(o,"mouseup",function(){setTimeout(function(){i&&i.wrapper&&n.contains(i.wrapper)&&(i.focus(),i=null)})})}),t.on("doubleclick",function(t){var i=e.getByElement(t.data.element);if(i&&!a.getNestedEditable(i.wrapper,t.data.element))return i.fire("doubleclick",{element:t.data.element})},null,null,1)}function A(e){var a=e.editor;a.on("key",function(a){var t,i=e.focused,l=e.widgetHoldingFocusedEditable;return i?t=i.fire("key",{keyCode:a.data.keyCode}):l&&(t=k(l,a.data.keyCode)),t},null,null,1)}function C(e){function a(a){e.focused&&B(e.focused,"cut"==a.name)}var t=e.editor;t.on("contentDom",function(){var e=t.editable();e.attachListener(e,"copy",a),e.attachListener(e,"cut",a)})}function w(e){var t=e.editor;t.on("selectionCheck",function(){e.fire("checkSelection")}),e.on("checkSelection",e.checkSelection,e),t.on("selectionChange",function(i){var l=a.getNestedEditable(t.editable(),i.data.selection.getStartElement()),n=l&&e.getByElement(l),o=e.widgetHoldingFocusedEditable;o?o===n&&o.focusedEditable.equals(l)||(v(e,o,null),n&&l&&v(e,n,l)):n&&l&&v(e,n,l)}),t.on("dataReady",function(){R(e).commit()}),t.on("blur",function(){var a;(a=e.focused)&&o(e,a),(a=e.widgetHoldingFocusedEditable)&&v(e,a,null)})}function L(e){F(e),E(e),e.on("checkWidgets",r),e.editor.on("contentDomInvalidated",e.checkWidgets,e)}function E(e){var t=e.editor,i={};t.on("toDataFormat",function(t){var l=CKEDITOR.tools.getNextNumber(),n=[];t.data.downcastingSessionId=l,i[l]=n,t.data.dataValue.forEach(function(t){var i,l,o=t.attributes;if("data-cke-widget-id"in o)i=e.instances[o["data-cke-widget-id"]],i&&(l=t.getFirst(a.isParserWidgetElement),n.push({wrapper:t,element:l,widget:i,editables:{}}),"1"!=l.attributes["data-cke-widget-keep-attr"]&&delete l.attributes["data-widget"]);else if("data-cke-widget-editable"in o)return n[n.length-1].editables[o["data-cke-widget-editable"]]=t,!1},CKEDITOR.NODE_ELEMENT,!0)},null,null,8),t.on("toDataFormat",function(e){if(e.data.downcastingSessionId)for(var a,t,l,n,o,r,s=i[e.data.downcastingSessionId];a=s.shift();){t=a.widget,l=a.element,n=t._.downcastFn&&t._.downcastFn.call(t,l);for(r in a.editables)o=a.editables[r],delete o.attributes.contenteditable,o.setHtml(t.editables[r].getData());n||(n=l),a.wrapper.replaceWith(n)}},null,null,13),t.on("contentDomUnload",function(){e.destroyAll(!0)})}function F(e){var t,i,l=e.editor;l.on("toHtml",function(i){var l,n=u(e);for(i.data.dataValue.forEach(n.iterator,CKEDITOR.NODE_ELEMENT,!0);l=n.toBeWrapped.pop();)s(l[0]),e.wrapElement(l[0],l[1]);t=i.data.protectedWhitespaces?3==i.data.dataValue.children.length&&a.isParserWidgetWrapper(i.data.dataValue.children[1]):1==i.data.dataValue.children.length&&a.isParserWidgetWrapper(i.data.dataValue.children[0])},null,null,8),l.on("dataReady",function(){i&&d(e,l.editable()),i=0,e.destroyAll(!0),e.initOnAll()}),l.on("loadSnapshot",function(a){/data-cke-widget/.test(a.data)&&(i=1),e.destroyAll(!0)},null,null,9),l.on("paste",function(e){var t=e.data;if(t.dataValue=t.dataValue.replace(Y,f),t.range){var i=a.getNestedEditable(l.editable(),t.range.startContainer);if(i){var n=CKEDITOR.filter.instances[i.data("cke-filter")];n&&l.setActiveFilter(n)}}}),l.on("afterInsertHtml",function(a){a.data.intoRange?e.checkWidgets({initOnlyNew:!0}):(l.fire("lockSnapshot"),e.checkWidgets({initOnlyNew:!0,focusInited:t}),l.fire("unlockSnapshot"))})}function R(e){var a=e.selected,t=[],i=a.slice(0),l=null;return{select:function(e){CKEDITOR.tools.indexOf(a,e)<0&&t.push(e);var l=CKEDITOR.tools.indexOf(i,e);return l>=0&&i.splice(l,1),this},focus:function(e){return l=e,this},commit:function(){var n,r,s=e.focused!==l;for(e.editor.fire("lockSnapshot"),s&&(n=e.focused)&&o(e,n);n=i.pop();)a.splice(CKEDITOR.tools.indexOf(a,n),1),n.isInited()&&(r=n.editor.checkDirty(),n.setSelected(!1),!r&&n.editor.resetDirty());for(s&&l&&(r=e.editor.checkDirty(),e.focused=l,e.fire("widgetFocused",{widget:l}),l.setFocused(!0),!r&&e.editor.resetDirty());n=t.pop();)a.push(n),n.setSelected(!0);e.editor.fire("unlockSnapshot")}}}function D(e,a,t){var i,l=0,n=z(a),o=e.data.classes||{};if(n){for(o=CKEDITOR.tools.clone(o);i=n.pop();)t?o[i]||(l=o[i]=1):o[i]&&(delete o[i],l=1);l&&e.setData("classes",o)}}function I(e){e.cancel()}function B(e,a){var t=e.editor,i=t.document;if(!i.getById("cke_copybin")){var l=t.blockless||CKEDITOR.env.ie?"span":"div",n=i.createElement(l),o=i.createElement(l),r=CKEDITOR.env.ie&&CKEDITOR.env.version<9;o.setAttributes({id:"cke_copybin","data-cke-temp":"1"}),n.setStyles({position:"absolute",width:"1px",height:"1px",overflow:"hidden"}),n.setStyle("ltr"==t.config.contentsLangDirection?"left":"right","-5000px");var s=t.createRange();s.setStartBefore(e.wrapper),s.setEndAfter(e.wrapper),n.setHtml('<span data-cke-copybin-start="1">\u200b</span>'+t.editable().getHtmlFromRange(s).getHtml()+'<span data-cke-copybin-end="1">\u200b</span>'),t.fire("saveSnapshot"),t.fire("lockSnapshot"),o.append(n),t.editable().append(o);var d=t.on("selectionChange",I,null,null,0),c=e.repository.on("checkSelection",I,null,null,0);if(r)var u=i.getDocumentElement().$,m=u.scrollTop;s=t.createRange(),s.selectNodeContents(n),s.select(),r&&(u.scrollTop=m),setTimeout(function(){a||e.focus(),o.remove(),d.removeListener(),c.removeListener(),t.fire("unlockSnapshot"),a&&(e.repository.del(e),t.fire("saveSnapshot"))},100)}}function z(e){var a=e.getDefinition().attributes,t=a&&a["class"];return t?t.split(/\s+/):null}function P(){var e=CKEDITOR.document.getActive(),a=this.editor,t=a.editable();(t.isInline()?t:a.document.getWindow().getFrame()).equals(e)&&a.focusManager.focus(t)}function x(){CKEDITOR.env.gecko&&this.editor.unlockSelection(),CKEDITOR.env.webkit||(this.editor.forceNextSelectionCheck(),this.editor.selectionChange(1))}function N(e){var a=null;e.on("data",function(){var e,t=this.data.classes;if(a!=t){for(e in a)t&&t[e]||this.removeClass(e);for(e in t)this.addClass(e);a=t}})}function j(e){function a(){return this.editor.lang.widget.label.replace(/%1/,this.pathName||this.element.getName())}e.on("data",function(){if(e.wrapper){var t=this.getLabel?this.getLabel():a.call(this);e.wrapper.setAttribute("role","region"),e.wrapper.setAttribute("aria-label",t)}},null,null,9999)}function O(e){if(e.draggable){var t,i=e.editor,l=e.wrapper.getLast(a.isDomDragHandlerContainer);l?t=l.findOne("img"):(l=new CKEDITOR.dom.element("span",i.document),l.setAttributes({"class":"cke_reset cke_widget_drag_handler_container",style:"background:rgba(220,220,220,0.5);background-image:url("+i.plugins.widget.path+"images/handle.png)"}),t=new CKEDITOR.dom.element("img",i.document),t.setAttributes({"class":"cke_reset cke_widget_drag_handler","data-cke-widget-drag-handler":"1",src:CKEDITOR.tools.transparentImageData,width:$,title:i.lang.widget.move,height:$,role:"presentation"}),e.inline&&t.setAttribute("draggable","true"),l.append(t),e.wrapper.append(l)),e.wrapper.on("dragover",function(e){e.data.preventDefault()}),e.wrapper.on("mouseenter",e.updateDragHandlerPosition,e),setTimeout(function(){e.on("data",e.updateDragHandlerPosition,e)},50),e.inline||(t.on("mousedown",M,e),CKEDITOR.env.ie&&CKEDITOR.env.version<9&&t.on("dragstart",function(e){e.data.preventDefault(!0)})),e.dragHandlerContainer=l}}function M(e){function a(){var a;for(m.reset();a=d.pop();)a.removeListener();V.call(this,c,e.sender)}var t,i,l=this.repository.finder,n=this.repository.locator,o=this.repository.liner,r=this.editor,s=r.editable(),d=[],c=[];this.repository._.draggedWidget=this;var u=l.greedySearch(),m=CKEDITOR.tools.eventsBuffer(50,function(){t=n.locate(u),c=n.sort(i,1),c.length&&(o.prepare(u,t),o.placeLine(c[0]),o.cleanup())});s.addClass("cke_widget_dragging"),d.push(s.on("mousemove",function(e){i=e.data.$.clientY,m.input()})),r.fire("dragstart",{target:e.sender}),d.push(r.document.once("mouseup",a,this)),s.isInline()||d.push(CKEDITOR.document.once("mouseup",a,this))}function V(e,a){var t=this.repository.finder,i=this.repository.liner,l=this.editor,n=this.editor.editable();if(!CKEDITOR.tools.isEmpty(i.visible)){var o=t.getRange(e[0]);this.focus(),l.fire("drop",{dropRange:o,target:o.startContainer})}n.removeClass("cke_widget_dragging"),i.hideVisible(),l.fire("dragend",{target:a})}function K(e){var a,t,i=e.editables;if(e.editables={},e.editables)for(a in i)t=i[a],e.initEditable(a,"string"==typeof t?{selector:t}:t)}function H(e){if(e.mask){var a=e.wrapper.findOne(".cke_widget_mask");a||(a=new CKEDITOR.dom.element("img",e.editor.document),a.setAttributes({src:CKEDITOR.tools.transparentImageData,"class":"cke_reset cke_widget_mask"}),e.wrapper.append(a)),e.mask=a}}function q(e){if(e.parts){var a,t,i={};for(t in e.parts)a=e.wrapper.findOne(e.parts[t]),i[t]=a;e.parts=i}}function U(e,t){W(e),q(e),K(e),H(e),O(e),N(e),j(e),CKEDITOR.env.ie&&CKEDITOR.env.version<9&&e.wrapper.on("dragstart",function(t){var i=t.data.getTarget();a.getNestedEditable(e,i)||e.inline&&a.isDomDragHandler(i)||t.data.preventDefault()}),e.wrapper.removeClass("cke_widget_new"),e.element.addClass("cke_widget_element"),e.on("key",function(a){var t=a.data.keyCode;if(13==t)e.edit();else{if(t==CKEDITOR.CTRL+67||t==CKEDITOR.CTRL+88)return void B(e,t==CKEDITOR.CTRL+88);if(t in Z||CKEDITOR.CTRL&t||CKEDITOR.ALT&t)return}return!1},null,null,999),e.on("doubleclick",function(a){e.edit()&&a.cancel()}),t.data&&e.on("data",t.data),t.edit&&e.on("edit",t.edit)}function _(e,a){var t=e.element.data("cke-widget-data");t&&e.setData(JSON.parse(decodeURIComponent(t))),a&&e.setData(a),e.data.classes||e.setData("classes",e.getClasses()),e.dataReady=!0,G(e),e.fire("data",e.data)}function W(e){var a=e.wrapper=e.element.getParent();a.setAttribute("data-cke-widget-id",e.id)}function G(e){e.element.data("cke-widget-data",encodeURIComponent(JSON.stringify(e.data)))}var $=15;CKEDITOR.plugins.add("widget",{lang:"af,ar,az,bg,ca,cs,cy,da,de,de-ch,el,en,en-gb,eo,es,eu,fa,fi,fr,gl,he,hr,hu,id,it,ja,km,ko,ku,lv,nb,nl,no,oc,pl,pt,pt-br,ru,sk,sl,sq,sv,tr,tt,ug,uk,vi,zh,zh-cn",requires:"lineutils,clipboard,widgetselection",onLoad:function(){CKEDITOR.addCss(".cke_widget_wrapper{position:relative;outline:none}.cke_widget_inline{display:inline-block}.cke_widget_wrapper:hover>.cke_widget_element{outline:2px solid yellow;cursor:default}.cke_widget_wrapper:hover .cke_widget_editable{outline:2px solid yellow}.cke_widget_wrapper.cke_widget_focused>.cke_widget_element,.cke_widget_wrapper .cke_widget_editable.cke_widget_editable_focused{outline:2px solid #ace}.cke_widget_editable{cursor:text}.cke_widget_drag_handler_container{position:absolute;width:"+$+"px;height:0;display:none;opacity:0.75;transition:height 0s 0.2s;line-height:0}.cke_widget_wrapper:hover>.cke_widget_drag_handler_container{height:"+$+"px;transition:none}.cke_widget_drag_handler_container:hover{opacity:1}img.cke_widget_drag_handler{cursor:move;width:"+$+"px;height:"+$+"px;display:inline-block}.cke_widget_mask{position:absolute;top:0;left:0;width:100%;height:100%;display:block}.cke_editable.cke_widget_dragging, .cke_editable.cke_widget_dragging *{cursor:move !important}")},beforeInit:function(a){a.widgets=new e(a)},afterInit:function(e){i(e),y(e)}}),e.prototype={MIN_SELECTION_CHECK_INTERVAL:500,add:function(e,a){return a=CKEDITOR.tools.prototypedCopy(a),a.name=e,a._=a._||{},this.editor.fire("widgetDefinition",a),a.template&&(a.template=new CKEDITOR.template(a.template)),l(this.editor,a),n(this,a),this.registered[e]=a,a},addUpcastCallback:function(e){this._.upcastCallbacks.push(e)},checkSelection:function(){var e,t=this.editor.getSelection(),i=t.getSelectedElement(),l=R(this);if(i&&(e=this.getByElement(i,!0)))return l.focus(e).select(e).commit();var n=t.getRanges()[0];if(!n||n.collapsed)return l.commit();var o,r=new CKEDITOR.dom.walker(n);for(r.evaluator=a.isDomWidgetWrapper;o=r.next();)l.select(this.getByElement(o));l.commit()},checkWidgets:function(e){this.fire("checkWidgets",CKEDITOR.tools.copy(e||{}))},del:function(e){if(this.focused===e){var a,t=e.editor,i=t.createRange();(a=i.moveToClosestEditablePosition(e.wrapper,!0))||(a=i.moveToClosestEditablePosition(e.wrapper,!1)),a&&t.getSelection().selectRanges([i])}e.wrapper.remove(),this.destroy(e,!0)},destroy:function(e,a){this.widgetHoldingFocusedEditable===e&&v(this,e,null,a),e.destroy(a),delete this.instances[e.id],this.fire("instanceDestroyed",e)},destroyAll:function(e,a){var t,i,l=this.instances;if(!a||e)for(i in l)t=l[i],this.destroy(t,e);else for(var n=a.find(".cke_widget_wrapper"),o=n.count(),r=0;r<o;++r)t=this.getByElement(n.getItem(r),!0),t&&this.destroy(t)},finalizeCreation:function(e){var t=e.getFirst();if(t&&a.isDomWidgetWrapper(t)){this.editor.insertElement(t);var i=this.getByElement(t);i.ready=!0,i.fire("ready"),i.focus()}},getByElement:function(){function e(e){return e.is(a)&&e.data("cke-widget-id")}var a={div:1,span:1};return function(a,t){if(!a)return null;var i=e(a);if(!t&&!i){var l=this.editor.editable();do a=a.getParent();while(a&&!a.equals(l)&&!(i=e(a)))}return this.instances[i]||null}}(),initOn:function(e,t,i){if(t?"string"==typeof t&&(t=this.registered[t]):t=this.registered[e.data("widget")],!t)return null;var l=this.wrapElement(e,t.name);if(l){if(l.hasClass("cke_widget_new")){var n=new a(this,this._.nextId++,e,t,i);return n.isInited()?(this.instances[n.id]=n,n):null}return this.getByElement(e)}return null},initOnAll:function(e){for(var t,i=(e||this.editor.editable()).find(".cke_widget_new"),l=[],n=i.count();n--;)t=this.initOn(i.getItem(n).getFirst(a.isDomWidgetElement)),t&&l.push(t);return l},onWidget:function(e){var a=Array.prototype.slice.call(arguments);a.shift();for(var t in this.instances){var i=this.instances[t];i.name==e&&i.on.apply(i,a)}this.on("instanceCreated",function(t){var i=t.data;i.name==e&&i.on.apply(i,a)})},parseElementClasses:function(e){if(!e)return null;e=CKEDITOR.tools.trim(e).split(/\s+/);for(var a,t={},i=0;a=e.pop();)a.indexOf("cke_")==-1&&(t[a]=i=1);return i?t:null},wrapElement:function(e,a){var t,i,l=null;if(e instanceof CKEDITOR.dom.element){if(a=a||e.data("widget"),t=this.registered[a],!t)return null;if(l=e.getParent(),l&&l.type==CKEDITOR.NODE_ELEMENT&&l.data("cke-widget-wrapper"))return l;e.hasAttribute("data-cke-widget-keep-attr")||e.data("cke-widget-keep-attr",e.data("widget")?1:0),e.data("widget",a),i=h(t,e.getName()),l=new CKEDITOR.dom.element(i?"span":"div"),l.setAttributes(p(i,a)),l.data("cke-display-name",t.pathName?t.pathName:e.getName()),e.getParent(!0)&&l.replace(e),e.appendTo(l)}else if(e instanceof CKEDITOR.htmlParser.element){if(a=a||e.attributes["data-widget"],t=this.registered[a],!t)return null;if(l=e.parent,l&&l.type==CKEDITOR.NODE_ELEMENT&&l.attributes["data-cke-widget-wrapper"])return l;"data-cke-widget-keep-attr"in e.attributes||(e.attributes["data-cke-widget-keep-attr"]=e.attributes["data-widget"]?1:0),a&&(e.attributes["data-widget"]=a),i=h(t,e.name),l=new CKEDITOR.htmlParser.element(i?"span":"div",p(i,a)),l.attributes["data-cke-display-name"]=t.pathName?t.pathName:e.name;var n,o=e.parent;o&&(n=e.getIndex(),e.remove()),l.add(e),o&&g(o,n,l)}return l},_tests_createEditableFilter:c},CKEDITOR.event.implementOn(e.prototype),a.prototype={addClass:function(e){this.element.addClass(e),this.wrapper.addClass(a.WRAPPER_CLASS_PREFIX+e)},applyStyle:function(e){D(this,e,1)},checkStyleActive:function(e){var a,t=z(e);if(!t)return!1;for(;a=t.pop();)if(!this.hasClass(a))return!1;return!0},destroy:function(e){if(this.fire("destroy"),this.editables)for(var a in this.editables)this.destroyEditable(a,e);e||("0"==this.element.data("cke-widget-keep-attr")&&this.element.removeAttribute("data-widget"),this.element.removeAttributes(["data-cke-widget-data","data-cke-widget-keep-attr"]),this.element.removeClass("cke_widget_element"),this.element.replace(this.wrapper)),this.wrapper=null},destroyEditable:function(e,a){var t=this.editables[e];t.removeListener("focus",x),t.removeListener("blur",P),this.editor.focusManager.remove(t),a||(this.repository.destroyAll(!1,t),t.removeClass("cke_widget_editable"),t.removeClass("cke_widget_editable_focused"),t.removeAttributes(["contenteditable","data-cke-widget-editable","data-cke-enter-mode"])),delete this.editables[e]},edit:function(){var e={dialog:this.dialog},a=this;return!(this.fire("edit",e)===!1||!e.dialog)&&(this.editor.openDialog(e.dialog,function(e){var t,i;a.fire("dialog",e)!==!1&&(t=e.on("show",function(){e.setupContent(a)}),i=e.on("ok",function(){var t,i=a.on("data",function(e){t=1,e.cancel()},null,null,0);a.editor.fire("saveSnapshot"),e.commitContent(a),i.removeListener(),t&&(a.fire("data",a.data),a.editor.fire("saveSnapshot"))}),e.once("hide",function(){t.removeListener(),i.removeListener()}))}),!0)},getClasses:function(){return this.repository.parseElementClasses(this.element.getAttribute("class"))},hasClass:function(e){return this.element.hasClass(e)},initEditable:function(e,a){var i=this._findOneNotNested(a.selector);return!(!i||!i.is(CKEDITOR.dtd.$editable))&&(i=new t(this.editor,i,{filter:c.call(this.repository,this.name,e,a)}),this.editables[e]=i,i.setAttributes({contenteditable:"true","data-cke-widget-editable":e,"data-cke-enter-mode":i.enterMode}),i.filter&&i.data("cke-filter",i.filter.id),i.addClass("cke_widget_editable"),i.removeClass("cke_widget_editable_focused"),a.pathName&&i.data("cke-display-name",a.pathName),this.editor.focusManager.add(i),i.on("focus",x,this),CKEDITOR.env.ie&&i.on("blur",P,this),i._.initialSetData=!0,i.setData(i.getHtml()),!0)},_findOneNotNested:function(e){for(var t,i,l=this.wrapper.find(e),n=0;n<l.count();n++)if(t=l.getItem(n),i=t.getAscendant(a.isDomWidgetWrapper),this.wrapper.equals(i))return t;return null},isInited:function(){return!(!this.wrapper||!this.inited)},isReady:function(){return this.isInited()&&this.ready},focus:function(){var e=this.editor.getSelection();if(e){var a=this.editor.checkDirty();e.fake(this.wrapper),!a&&this.editor.resetDirty()}this.editor.focus()},removeClass:function(e){this.element.removeClass(e),this.wrapper.removeClass(a.WRAPPER_CLASS_PREFIX+e)},removeStyle:function(e){D(this,e,0)},setData:function(e,a){var t=this.data,i=0;if("string"==typeof e)t[e]!==a&&(t[e]=a,i=1);else{var l=e;for(e in l)t[e]!==l[e]&&(i=1,t[e]=l[e])}return i&&this.dataReady&&(G(this),this.fire("data",t)),this},setFocused:function(e){return this.wrapper[e?"addClass":"removeClass"]("cke_widget_focused"),this.fire(e?"focus":"blur"),this},setSelected:function(e){return this.wrapper[e?"addClass":"removeClass"]("cke_widget_selected"),this.fire(e?"select":"deselect"),this},updateDragHandlerPosition:function(){var e=this.editor,a=this.element.$,t=this._.dragHandlerOffset,i={x:a.offsetLeft,y:a.offsetTop-$};if(!t||i.x!=t.x||i.y!=t.y){var l=e.checkDirty();e.fire("lockSnapshot"),this.dragHandlerContainer.setStyles({top:i.y+"px",left:i.x+"px",display:"block"}),e.fire("unlockSnapshot"),!l&&e.resetDirty(),this._.dragHandlerOffset=i}}},CKEDITOR.event.implementOn(a.prototype),a.getNestedEditable=function(e,t){return!t||t.equals(e)?null:a.isDomNestedEditable(t)?t:a.getNestedEditable(e,t.getParent())},a.isDomDragHandler=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasAttribute("data-cke-widget-drag-handler")},a.isDomDragHandlerContainer=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasClass("cke_widget_drag_handler_container")},a.isDomNestedEditable=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasAttribute("data-cke-widget-editable")},a.isDomWidgetElement=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasAttribute("data-widget")},a.isDomWidgetWrapper=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&e.hasAttribute("data-cke-widget-wrapper")},a.isParserWidgetElement=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&!!e.attributes["data-widget"]},a.isParserWidgetWrapper=function(e){return e.type==CKEDITOR.NODE_ELEMENT&&!!e.attributes["data-cke-widget-wrapper"]},a.WRAPPER_CLASS_PREFIX="cke_widget_wrapper_",t.prototype=CKEDITOR.tools.extend(CKEDITOR.tools.prototypedCopy(CKEDITOR.dom.element.prototype),{setData:function(e){this._.initialSetData||this.editor.widgets.destroyAll(!1,this),this._.initialSetData=!1,e=this.editor.dataProcessor.toHtml(e,{context:this.getName(),filter:this.filter,enterMode:this.enterMode}),this.setHtml(e),this.editor.widgets.initOnAll(this)},getData:function(){return this.editor.dataProcessor.toDataFormat(this.getHtml(),{context:this.getName(),filter:this.filter,enterMode:this.enterMode})}});var Y=new RegExp('^(?:<(?:div|span)(?: data-cke-temp="1")?(?: id="cke_copybin")?(?: data-cke-temp="1")?>)?(?:<(?:div|span)(?: style="[^"]+")?>)?<span [^>]*data-cke-copybin-start="1"[^>]*>.?</span>([\\s\\S]+)<span [^>]*data-cke-copybin-end="1"[^>]*>.?</span>(?:</(?:div|span)>)?(?:</(?:div|span)>)?$',"i"),Z={37:1,38:1,39:1,40:1,8:1,46:1};!function(){function e(){}function t(e,a,t){if(!t)return!1;if(!this.checkElement(e))return!1;var i=t.widgets.getByElement(e,!0);return i&&i.checkStyleActive(this)}function i(e){var a,t=e.widget;l[t]||(l[t]={});for(var i=0,n=e.group.length;i<n;i++)a=e.group[i],l[t][a]||(l[t][a]=[]),l[t][a].push(e)}var l={};CKEDITOR.style.addCustomHandler({type:"widget",setup:function(e){this.widget=e.widget,this.group="string"==typeof e.group?[e.group]:e.group,this.group&&i(this)},apply:function(e){var a;e instanceof CKEDITOR.editor&&this.checkApplicable(e.elementPath(),e)&&(a=e.widgets.focused,this.group&&this.removeStylesFromSameGroup(e),a.applyStyle(this))},remove:function(e){e instanceof CKEDITOR.editor&&this.checkApplicable(e.elementPath(),e)&&e.widgets.focused.removeStyle(this)},removeStylesFromSameGroup:function(e){var a,t,i=!1;if(!(e instanceof CKEDITOR.editor))return!1;if(t=e.elementPath(),this.checkApplicable(t,e))for(var n=0,o=this.group.length;n<o;n++){a=l[this.widget][this.group[n]];for(var r=0;r<a.length;r++)a[r]!==this&&a[r].checkActive(t,e)&&(e.widgets.focused.removeStyle(a[r]),i=!0)}return i},checkActive:function(e,a){return this.checkElementMatch(e.lastElement,0,a)},checkApplicable:function(e,a){return a instanceof CKEDITOR.editor&&this.checkElement(e.lastElement)},checkElementMatch:t,checkElementRemovable:t,checkElement:function(e){if(!a.isDomWidgetWrapper(e))return!1;var t=e.getFirst(a.isDomWidgetElement);return t&&t.data("widget")==this.widget},buildPreview:function(e){return e||this._.definition.name},toAllowedContentRules:function(e){if(!e)return null;var a,t=e.widgets.registered[this.widget],i={};return t?t.styleableElements?(a=this.getClassesArray())?(i[t.styleableElements]={classes:a,propertiesOnly:!0},i):null:t.styleToAllowedContentRules?t.styleToAllowedContentRules(this):null:null},getClassesArray:function(){var e=this._.definition.attributes&&this._.definition.attributes["class"];return e?CKEDITOR.tools.trim(e).split(/\s+/):null},applyToRange:e,removeFromRange:e,applyToObject:e})}(),CKEDITOR.plugins.widget=a,a.repository=e,a.nestedEditable=t}();