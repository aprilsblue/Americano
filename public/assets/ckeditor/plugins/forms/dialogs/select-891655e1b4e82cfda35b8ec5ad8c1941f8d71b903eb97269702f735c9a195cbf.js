CKEDITOR.dialog.add("select",function(e){function a(e,a,t,i,o){return e=d(e),i=i?i.createElement("OPTION"):document.createElement("OPTION"),!(!e||!i||"option"!=i.getName())&&(CKEDITOR.env.ie?(isNaN(parseInt(o,10))?e.$.options.add(i.$):e.$.options.add(i.$,o),i.$.innerHTML=0<a.length?a:"",i.$.value=t):(null!==o&&o<e.getChildCount()?e.getChild(0>o?0:o).insertBeforeMe(i):e.append(i),i.setText(0<a.length?a:""),i.setValue(t)),i)}function t(e){e=d(e);for(var a=l(e),t=e.getChildren().count()-1;0<=t;t--)e.getChild(t).$.selected&&e.getChild(t).remove();r(e,a)}function i(e,a,t,i){return e=d(e),!(0>a)&&(e=e.getChild(a),e.setText(t),e.setValue(i),e)}function o(e){for(e=d(e);e.getChild(0)&&e.getChild(0).remove(););}function n(e,t,i){e=d(e);var o=l(e);if(0>o)return!1;if(t=o+t,t=0>t?0:t,t=t>=e.getChildCount()?e.getChildCount()-1:t,o==t)return!1;var o=e.getChild(o),n=o.getText(),s=o.getValue();return o.remove(),o=a(e,n,s,i?i:null,t),r(e,t),o}function l(e){return(e=d(e))?e.$.selectedIndex:-1}function r(e,a){if(e=d(e),0>a)return null;var t=e.getChildren().count();return e.$.selectedIndex=a>=t?t-1:a,e}function s(e){return!!(e=d(e))&&e.getChildren()}function d(e){return e&&e.domId&&e.getInputElement().$?e.getInputElement():!(!e||!e.$)&&e}return{title:e.lang.forms.select.title,minWidth:CKEDITOR.env.ie?460:395,minHeight:CKEDITOR.env.ie?320:300,onShow:function(){delete this.selectBox,this.setupContent("clear");var e=this.getParentEditor().getSelection().getSelectedElement();if(e&&"select"==e.getName()){this.selectBox=e,this.setupContent(e.getName(),e);for(var e=s(e),a=0;a<e.count();a++)this.setupContent("option",e.getItem(a))}},onOk:function(){var e=this.getParentEditor(),a=this.selectBox,t=!a;if(t&&(a=e.document.createElement("select")),this.commitContent(a),t&&(e.insertElement(a),CKEDITOR.env.ie)){var i=e.getSelection(),o=i.createBookmarks();setTimeout(function(){i.selectBookmarks(o)},0)}},contents:[{id:"info",label:e.lang.forms.select.selectInfo,title:e.lang.forms.select.selectInfo,accessKey:"",elements:[{id:"txtName",type:"text",widths:["25%","75%"],labelLayout:"horizontal",label:e.lang.common.name,"default":"",accessKey:"N",style:"width:350px",setup:function(e,a){"clear"==e?this.setValue(this["default"]||""):"select"==e&&this.setValue(a.data("cke-saved-name")||a.getAttribute("name")||"")},commit:function(e){this.getValue()?e.data("cke-saved-name",this.getValue()):(e.data("cke-saved-name",!1),e.removeAttribute("name"))}},{id:"txtValue",type:"text",widths:["25%","75%"],labelLayout:"horizontal",label:e.lang.forms.select.value,style:"width:350px","default":"",className:"cke_disabled",onLoad:function(){this.getInputElement().setAttribute("readOnly",!0)},setup:function(e,a){"clear"==e?this.setValue(""):"option"==e&&a.getAttribute("selected")&&this.setValue(a.$.value)}},{type:"hbox",className:"cke_dialog_forms_select_order_txtsize",widths:["175px","170px"],children:[{id:"txtSize",type:"text",labelLayout:"horizontal",label:e.lang.forms.select.size,"default":"",accessKey:"S",style:"width:175px",validate:function(){var a=CKEDITOR.dialog.validate.integer(e.lang.common.validateNumberFailed);return""===this.getValue()||a.apply(this)},setup:function(e,a){"select"==e&&this.setValue(a.getAttribute("size")||""),CKEDITOR.env.webkit&&this.getInputElement().setStyle("width","86px")},commit:function(e){this.getValue()?e.setAttribute("size",this.getValue()):e.removeAttribute("size")}},{type:"html",html:"<span>"+CKEDITOR.tools.htmlEncode(e.lang.forms.select.lines)+"</span>"}]},{type:"html",html:"<span>"+CKEDITOR.tools.htmlEncode(e.lang.forms.select.opAvail)+"</span>"},{type:"hbox",widths:["115px","115px","100px"],className:"cke_dialog_forms_select_order",children:[{type:"vbox",children:[{id:"txtOptName",type:"text",label:e.lang.forms.select.opText,style:"width:115px",setup:function(e){"clear"==e&&this.setValue("")}},{type:"select",id:"cmbName",label:"",title:"",size:5,style:"width:115px;height:75px",items:[],onChange:function(){var e=this.getDialog(),a=e.getContentElement("info","cmbValue"),t=e.getContentElement("info","txtOptName"),e=e.getContentElement("info","txtOptValue"),i=l(this);r(a,i),t.setValue(this.getValue()),e.setValue(a.getValue())},setup:function(e,t){"clear"==e?o(this):"option"==e&&a(this,t.getText(),t.getText(),this.getDialog().getParentEditor().document)},commit:function(e){var t=this.getDialog(),i=s(this),n=s(t.getContentElement("info","cmbValue")),l=t.getContentElement("info","txtValue").getValue();o(e);for(var r=0;r<i.count();r++){var d=a(e,i.getItem(r).getValue(),n.getItem(r).getValue(),t.getParentEditor().document);n.getItem(r).getValue()==l&&(d.setAttribute("selected","selected"),d.selected=!0)}}}]},{type:"vbox",children:[{id:"txtOptValue",type:"text",label:e.lang.forms.select.opValue,style:"width:115px",setup:function(e){"clear"==e&&this.setValue("")}},{type:"select",id:"cmbValue",label:"",size:5,style:"width:115px;height:75px",items:[],onChange:function(){var e=this.getDialog(),a=e.getContentElement("info","cmbName"),t=e.getContentElement("info","txtOptName"),e=e.getContentElement("info","txtOptValue"),i=l(this);r(a,i),t.setValue(a.getValue()),e.setValue(this.getValue())},setup:function(e,t){if("clear"==e)o(this);else if("option"==e){var i=t.getValue();a(this,i,i,this.getDialog().getParentEditor().document),"selected"==t.getAttribute("selected")&&this.getDialog().getContentElement("info","txtValue").setValue(i)}}}]},{type:"vbox",padding:5,children:[{type:"button",id:"btnAdd",label:e.lang.forms.select.btnAdd,title:e.lang.forms.select.btnAdd,style:"width:100%;",onClick:function(){var e=this.getDialog(),t=e.getContentElement("info","txtOptName"),i=e.getContentElement("info","txtOptValue"),o=e.getContentElement("info","cmbName"),n=e.getContentElement("info","cmbValue");a(o,t.getValue(),t.getValue(),e.getParentEditor().document),a(n,i.getValue(),i.getValue(),e.getParentEditor().document),t.setValue(""),i.setValue("")}},{type:"button",id:"btnModify",label:e.lang.forms.select.btnModify,title:e.lang.forms.select.btnModify,style:"width:100%;",onClick:function(){var e=this.getDialog(),a=e.getContentElement("info","txtOptName"),t=e.getContentElement("info","txtOptValue"),o=e.getContentElement("info","cmbName"),e=e.getContentElement("info","cmbValue"),n=l(o);0<=n&&(i(o,n,a.getValue(),a.getValue()),i(e,n,t.getValue(),t.getValue()))}},{type:"button",id:"btnUp",style:"width:100%;",label:e.lang.forms.select.btnUp,title:e.lang.forms.select.btnUp,onClick:function(){var e=this.getDialog(),a=e.getContentElement("info","cmbName"),t=e.getContentElement("info","cmbValue");n(a,-1,e.getParentEditor().document),n(t,-1,e.getParentEditor().document)}},{type:"button",id:"btnDown",style:"width:100%;",label:e.lang.forms.select.btnDown,title:e.lang.forms.select.btnDown,onClick:function(){var e=this.getDialog(),a=e.getContentElement("info","cmbName"),t=e.getContentElement("info","cmbValue");n(a,1,e.getParentEditor().document),n(t,1,e.getParentEditor().document)}}]}]},{type:"hbox",widths:["40%","20%","40%"],children:[{type:"button",id:"btnSetValue",label:e.lang.forms.select.btnSetValue,title:e.lang.forms.select.btnSetValue,onClick:function(){var e=this.getDialog(),a=e.getContentElement("info","cmbValue");e.getContentElement("info","txtValue").setValue(a.getValue())}},{type:"button",id:"btnDelete",label:e.lang.forms.select.btnDelete,title:e.lang.forms.select.btnDelete,onClick:function(){var e=this.getDialog(),a=e.getContentElement("info","cmbName"),i=e.getContentElement("info","cmbValue"),o=e.getContentElement("info","txtOptName"),e=e.getContentElement("info","txtOptValue");t(a),t(i),o.setValue(""),e.setValue("")}},{type:"vbox",children:[{id:"chkMulti",type:"checkbox",label:e.lang.forms.select.chkMulti,"default":"",accessKey:"M",value:"checked",setup:function(e,a){"select"==e&&this.setValue(a.getAttribute("multiple"))},commit:function(e){this.getValue()?e.setAttribute("multiple",this.getValue()):e.removeAttribute("multiple")}},{id:"required",type:"checkbox",label:e.lang.forms.select.required,"default":"",accessKey:"Q",value:"checked",setup:function(e,a){"select"==e&&this.setValue(a.getAttribute("required"))},commit:function(e){this.getValue()?e.setAttribute("required","required"):e.removeAttribute("required")}}]}]}]}]}});