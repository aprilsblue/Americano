!function(){"use strict";function e(e){return e.getName&&!e.hasAttribute("data-cke-temp")}CKEDITOR.plugins.add("widgetselection",{init:function(e){if(CKEDITOR.env.webkit){var a=CKEDITOR.plugins.widgetselection;e.on("contentDom",function(e){var t=e.editor,i=t.document,l=t.editable();l.attachListener(i,"keydown",function(e){var t=e.data.$;65==e.data.getKey()&&(CKEDITOR.env.mac&&t.metaKey||!CKEDITOR.env.mac&&t.ctrlKey)&&CKEDITOR.tools.setTimeout(function(){a.addFillers(l)||a.removeFillers(l)},0)},null,null,-1),t.on("selectionCheck",function(e){a.removeFillers(e.editor.editable())}),t.on("paste",function(e){e.data.dataValue=a.cleanPasteData(e.data.dataValue)}),"selectall"in t.plugins&&a.addSelectAllIntegration(t)})}}}),CKEDITOR.plugins.widgetselection={startFiller:null,endFiller:null,fillerAttribute:"data-cke-filler-webkit",fillerContent:"&nbsp;",fillerTagName:"div",addFillers:function(a){var t=a.editor;if(!this.isWholeContentSelected(a)&&a.getChildCount()>0){var i=a.getFirst(e),l=a.getLast(e);if(i&&i.type==CKEDITOR.NODE_ELEMENT&&!i.isEditable()&&(this.startFiller=this.createFiller(),a.append(this.startFiller,1)),l&&l.type==CKEDITOR.NODE_ELEMENT&&!l.isEditable()&&(this.endFiller=this.createFiller(!0),a.append(this.endFiller,0)),this.hasFiller(a)){var n=t.createRange();return n.selectNodeContents(a),n.select(),!0}}return!1},removeFillers:function(e){if(this.hasFiller(e)&&!this.isWholeContentSelected(e)){var a=e.findOne(this.fillerTagName+"["+this.fillerAttribute+"=start]"),t=e.findOne(this.fillerTagName+"["+this.fillerAttribute+"=end]");this.startFiller&&a&&this.startFiller.equals(a)?this.removeFiller(this.startFiller,e):this.startFiller=a,this.endFiller&&t&&this.endFiller.equals(t)?this.removeFiller(this.endFiller,e):this.endFiller=t}},cleanPasteData:function(e){return e&&e.length&&(e=e.replace(this.createFillerRegex(),"").replace(this.createFillerRegex(!0),"")),e},isWholeContentSelected:function(e){var a=e.editor.getSelection().getRanges()[0];if(a){if(a&&a.collapsed)return!1;var t=a.clone();return t.enlarge(CKEDITOR.ENLARGE_ELEMENT),!!(t&&e&&t.startContainer&&t.endContainer&&0===t.startOffset&&t.endOffset===e.getChildCount()&&t.startContainer.equals(e)&&t.endContainer.equals(e))}return!1},hasFiller:function(e){return e.find(this.fillerTagName+"["+this.fillerAttribute+"]").count()>0},createFiller:function(e){var a=new CKEDITOR.dom.element(this.fillerTagName);return a.setHtml(this.fillerContent),a.setAttribute(this.fillerAttribute,e?"end":"start"),a.setAttribute("data-cke-temp",1),a.setStyles({display:"block",width:0,height:0,padding:0,border:0,margin:0,position:"absolute",top:0,left:"-9999px",opacity:0,overflow:"hidden"}),a},removeFiller:function(e,a){if(e){var t,i,l,n=a.editor,o=a.editor.getSelection().getRanges()[0],r=o.startPath(),s=n.createRange();r.contains(e)&&(t=e.getHtml(),l=!0),i="start"==e.getAttribute(this.fillerAttribute),e.remove(),e=null,t&&t.length>0&&t!=this.fillerContent?(a.insertHtmlIntoRange(t,n.getSelection().getRanges()[0]),s.setStartAt(a.getChild(a.getChildCount()-1),CKEDITOR.POSITION_BEFORE_END),n.getSelection().selectRanges([s])):l&&(i?s.setStartAt(a.getFirst().getNext(),CKEDITOR.POSITION_AFTER_START):s.setEndAt(a.getLast().getPrevious(),CKEDITOR.POSITION_BEFORE_END),a.editor.getSelection().selectRanges([s]))}},createFillerRegex:function(e){var a=this.createFiller(e).getOuterHtml().replace(/style="[^"]*"/gi,'style="[^"]*"').replace(/>[^<]*</gi,">[^<]*<");return new RegExp((e?"":"^")+a+(e?"$":""))},addSelectAllIntegration:function(e){var a=this;e.editable().attachListener(e,"beforeCommandExec",function(t){var i=e.editable();"selectAll"==t.data.name&&i&&a.addFillers(i)},null,null,9999)}}}();